<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - –ö–ú–£ 2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
            background-color: #e8e8e8;
            color: #2c2c2c;
            line-height: 1.65;
            font-size: 15px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Top Navigation */
        .top-nav {
            background: linear-gradient(135deg, #5B4E99 0%, #4a3d7f 100%);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .top-nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            height: 60px;
        }

        .top-nav-logo {
            color: #fff;
            font-size: 18px;
            font-weight: 700;
            text-decoration: none;
            letter-spacing: -0.02em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .top-nav-logo:hover {
            opacity: 0.9;
        }

        .top-nav-menu {
            display: flex;
            list-style: none;
            gap: 8px;
            margin: 0;
            padding: 0;
        }

        .top-nav-item {
            position: relative;
        }

        .top-nav-link {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: block;
            letter-spacing: -0.01em;
        }

        .top-nav-link:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
        }

        .top-nav-link.active {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        .container {
            display: flex;
            min-height: calc(100vh - 60px);
            max-width: 1400px;
            margin: 0 auto;
            background-color: #fff;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background-color: #fff;
            padding: 35px 25px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 45px;
            padding-bottom: 35px;
            border-bottom: 1px solid #e8e8e8;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #5B4E99;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .user-name {
            font-weight: 600;
            color: #5B4E99;
            font-size: 16px;
            letter-spacing: -0.01em;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 6px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 13px 16px;
            text-decoration: none;
            color: #444;
            border-radius: 10px;
            transition: all 0.25s ease;
            cursor: pointer;
            position: relative;
            font-size: 15px;
            font-weight: 500;
            letter-spacing: -0.01em;
        }

        .nav-link:hover {
            background-color: #f5f4f8;
            color: #5B4E99;
        }

        .nav-link.active {
            background-color: #f5f4f8;
            color: #5B4E99;
            font-weight: 500;
        }

        .nav-badge {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, #E91E63 0%, #D81B60 100%);
            border-radius: 50%;
            box-shadow: 0 0 0 2px rgba(233, 30, 99, 0.15);
            animation: pulse-badge 2s ease-in-out infinite;
            margin-left: auto;
        }

        @keyframes pulse-badge {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        .nav-submenu {
            list-style: none;
            margin-left: 20px;
            margin-top: 4px;
            display: none;
        }

        .nav-submenu.active {
            display: block;
        }

        .nav-submenu .nav-link {
            font-size: 14px;
            padding: 8px 16px;
        }

        .nav-link.logout {
            color: #999;
            margin-top: 30px;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 40px 80px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        @media (min-width: 1400px) {
            .main-content {
                padding: 40px 120px;
            }
        }

        .page-title {
            font-size: 42px;
            font-weight: 800;
            color: #5B4E99;
            margin-bottom: 50px;
            text-transform: uppercase;
            letter-spacing: -0.02em;
            line-height: 1.1;
        }

        .section {
            background-color: #fff;
            border-radius: 16px;
            padding: 45px;
            margin-bottom: 35px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04), 0 4px 16px rgba(0, 0, 0, 0.04);
            transition: box-shadow 0.3s ease;
        }

        .section:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06), 0 8px 24px rgba(0, 0, 0, 0.06);
        }

        .section.subsection {
            background-color: #f9f8fc;
            padding: 35px;
            margin-bottom: 20px;
            margin-left: 0;
            border-left: 4px solid #5B4E99;
            box-shadow: 0 1px 3px rgba(91, 78, 153, 0.06);
        }

        .section.subsection:hover {
            box-shadow: 0 2px 6px rgba(91, 78, 153, 0.1);
        }


        .section.subsection.locked {
            opacity: 0.6;
            pointer-events: none;
        }

        .info-message {
            background-color: #FFF3E0;
            border-left: 4px solid #FF9800;
            padding: 16px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-size: 14px;
            color: #E65100;
            line-height: 1.6;
        }

        .section.parent-section {
            padding-bottom: 30px;
        }

        .subsections-container {
            margin-top: 30px;
        }

        .section-title {
            font-size: 28px;
            font-weight: 700;
            color: #5B4E99;
            margin-bottom: 28px;
            text-transform: uppercase;
            letter-spacing: -0.01em;
            line-height: 1.2;
        }

        .subsection-title {
            font-size: 20px;
            font-weight: 600;
            color: #5B4E99;
            margin-bottom: 18px;
            letter-spacing: -0.01em;
            line-height: 1.3;
        }

        .section-subtitle {
            font-size: 15px;
            color: #666;
            margin-bottom: 32px;
            line-height: 1.7;
            letter-spacing: -0.01em;
        }

        /* Form Styles */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .form-row.single {
            grid-template-columns: 1fr;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #2c2c2c;
            margin-bottom: 10px;
            letter-spacing: -0.01em;
        }

        .form-label.required::after {
            content: '*';
            color: #E91E63;
            margin-left: 4px;
        }

        .form-label.optional {
            color: #999;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 13px 16px;
            border: 2px solid #d0d0d0;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.25s ease;
            font-family: inherit;
            background-color: #e8e8e8;
            color: #1a1a1a;
        }

        .form-input:hover,
        .form-select:hover {
            border-color: #b0b0b0;
            background-color: #e0e0e0;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: #5B4E99;
            background-color: #f0f0f0;
            box-shadow: 0 0 0 4px rgba(91, 78, 153, 0.12);
        }

        .form-input.error {
            border-color: #E91E63;
        }

        .error-message {
            font-size: 12px;
            color: #E91E63;
            margin-top: 4px;
        }

        .radio-group {
            display: flex;
            gap: 30px;
            margin-top: 12px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .radio-option label {
            cursor: pointer;
            font-size: 14px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-top: 20px;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            font-size: 13px;
            color: #666;
            cursor: pointer;
        }

        .checkbox-group label a {
            color: #5B4E99;
            text-decoration: none;
        }

        .checkbox-group label a:hover {
            text-decoration: underline;
        }

        /* Button Styles */
        .btn {
            padding: 15px 36px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.25s ease;
            font-family: inherit;
            letter-spacing: 0.02em;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #5B4E99 0%, #4a3d7f 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(91, 78, 153, 0.25);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(91, 78, 153, 0.35);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(91, 78, 153, 0.25);
        }

        .btn-secondary {
            background-color: transparent;
            color: #5B4E99;
            border: 2px solid #5B4E99;
        }

        .btn-secondary:hover {
            background-color: #f5f4f8;
            border-color: #4a3d7f;
            color: #4a3d7f;
            transform: translateY(-1px);
        }

        .btn-secondary:active {
            transform: translateY(0);
        }

        .btn-group {
            display: flex;
            gap: 16px;
            margin-top: 35px;
        }

        /* Display Mode Styles */
        .display-mode {
            display: none;
        }

        .display-mode.active {
            display: block;
        }

        .edit-mode {
            display: block;
        }

        .edit-mode.hidden {
            display: none !important;
        }

        /* Hide report form by default - will be shown only after registration as speaker */
        #report-form-mode {
            display: none !important;
        }

        /* Override when explicitly set to block via JavaScript */
        #report-form-mode[style*="block"] {
            display: block !important;
        }

        .display-field {
            margin-bottom: 26px;
        }

        .display-field-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 6px;
            letter-spacing: 0.08em;
            font-weight: 600;
        }

        .display-field-value {
            font-size: 16px;
            color: #2c2c2c;
            padding: 10px 0;
            font-weight: 500;
            letter-spacing: -0.01em;
        }

        .display-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px 44px;
        }

        /* Notice Box */
        .notice-box {
            background: linear-gradient(135deg, #E3F2FD 0%, #E8F5E9 100%);
            border-left: 5px solid #2196F3;
            padding: 18px 22px;
            margin-bottom: 28px;
            border-radius: 10px;
            font-size: 14px;
            color: #1565C0;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);
            font-weight: 500;
            letter-spacing: -0.01em;
        }

        .notice-box.info {
            background: linear-gradient(135deg, #F3E5F5 0%, #F8E5F1 100%);
            border-left-color: #9C27B0;
            color: #6A1B9A;
            box-shadow: 0 2px 8px rgba(156, 39, 176, 0.1);
        }

        .notice-box strong {
            font-weight: 700;
        }

        /* Success State */
        .success-state {
            display: none;
            text-align: left;
        }

        .success-state.active {
            display: block;
        }

        .success-message {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 30px;
        }

        .success-details {
            margin: 30px 0;
        }

        .detail-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        .detail-label {
            font-weight: 500;
            color: #666;
        }

        .detail-value {
            color: #5B4E99;
            font-weight: 600;
        }

        .report-title {
            font-size: 16px;
            line-height: 1.5;
            color: #333;
            margin-top: 10px;
        }

        /* Archive Styles */
        .archive-item {
            padding: 25px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: all 0.2s;
        }

        .archive-item:hover {
            border-color: #5B4E99;
            box-shadow: 0 4px 12px rgba(91, 78, 153, 0.1);
        }

        .archive-year {
            font-size: 18px;
            font-weight: 700;
            color: #5B4E99;
            margin-bottom: 8px;
        }

        .archive-title {
            font-size: 16px;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .archive-meta {
            font-size: 14px;
            color: #999;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 16px;
        }

        /* My Reports Styles */
        .report-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .report-card {
            background: linear-gradient(135deg, #fafbff 0%, #f5f7ff 100%);
            border: 2px solid #e8eaf5;
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s ease;
            position: relative;
        }

        .report-card:hover {
            border-color: #5B4E99;
            box-shadow: 0 4px 16px rgba(91, 78, 153, 0.12);
            transform: translateY(-2px);
        }

        .report-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .report-card-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c2c2c;
            margin-bottom: 8px;
            line-height: 1.4;
            flex: 1;
        }

        .report-card-meta {
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
        }

        .report-card-actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
            border-radius: 8px;
        }

        .report-status {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .report-status.pending {
            background-color: #FFF3E0;
            color: #E65100;
        }

        .report-status.accepted {
            background-color: #E8F5E9;
            color: #2E7D32;
        }

        .report-status.scheduled {
            background-color: #E3F2FD;
            color: #1565C0;
        }


        /* Contacts Styles - Compact */
        .contacts-compact {
            display: flex;
            flex-direction: column;
            gap: 16px;
            background: #f9f8fc;
            border: 2px solid #e8eaf5;
            border-radius: 12px;
            padding: 24px;
            max-width: 600px;
        }

        .contact-item {
            display: flex;
            gap: 12px;
            align-items: baseline;
            font-size: 15px;
            line-height: 1.6;
        }

        .contact-label {
            font-weight: 600;
            color: #5B4E99;
            min-width: 160px;
            flex-shrink: 0;
        }

        .contact-link {
            color: #5B4E99;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .contact-link:hover {
            color: #4a3d7f;
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }

            .main-content {
                padding: 20px;
            }

            .form-row,
            .display-grid {
                grid-template-columns: 1fr;
            }

            .detail-row {
                grid-template-columns: 1fr;
                gap: 5px;
            }

            .top-nav-container {
                padding: 0 20px;
                height: auto;
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
                padding: 12px 20px;
            }

            .top-nav-menu {
                flex-wrap: wrap;
                gap: 6px;
            }

            .top-nav-link {
                font-size: 13px;
                padding: 6px 12px;
            }

            .contact-item {
                flex-direction: column;
                gap: 4px;
            }

            .contact-label {
                min-width: auto;
            }
        }

        /* Smooth Scroll */
        html {
            scroll-behavior: smooth;
        }

        /* Icon styles */
        .nav-link::before {
            content: '‚Ä∫';
            margin-right: 8px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .nav-link.active::before,
        .nav-link:hover::before {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Top Navigation -->
    <header class="top-nav">
        <div class="top-nav-container">
            <a href="https://kmu.cosmos.ru" class="top-nav-logo">
                <span>üöÄ</span>
                <span>–ö–ú–£ 2026</span>
            </a>
            <nav>
                <ul class="top-nav-menu">
                    <li class="top-nav-item">
                        <a href="https://kmu.cosmos.ru" class="top-nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
                    </li>
                    <li class="top-nav-item">
                        <a href="https://kmu.cosmos.ru/participants" class="top-nav-link">–£—á–∞—Å—Ç–Ω–∏–∫–∞–º</a>
                    </li>
                    <li class="top-nav-item">
                        <a href="https://kmu.cosmos.ru/program" class="top-nav-link">–ü—Ä–æ–≥—Ä–∞–º–º–∞</a>
                    </li>
                    <li class="top-nav-item">
                        <a href="https://kmu.cosmos.ru/archive" class="top-nav-link">–ê—Ä—Ö–∏–≤</a>
                    </li>
                    <li class="top-nav-item">
                        <a href="#" class="top-nav-link active">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="user-info">
                <div class="user-avatar">–ò–ò</div>
                <div class="user-name">–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤</div>
            </div>

            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a class="nav-link active" onclick="scrollToSection('personal-data')">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" onclick="toggleSubmenu('kmu-submenu'); scrollToSection('kmu-2026')">
                            <span>–ö–ú–£ 2026</span>
                            <span class="nav-badge"></span>
                        </a>
                        <ul class="nav-submenu" id="kmu-submenu">
                            <li class="nav-item">
                                <a class="nav-link" onclick="scrollToSection('registration')">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="scrollToSection('submit-report')">–ü–æ–¥–∞—Ç—å –¥–æ–∫–ª–∞–¥</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="scrollToSection('my-reports')">–ú–æ–∏ –¥–æ–∫–ª–∞–¥—ã</a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" onclick="scrollToSection('archive')">–ê—Ä—Ö–∏–≤ —É—á–∞—Å—Ç–∏–π</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" onclick="scrollToSection('contacts')">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link logout">–í—ã–π—Ç–∏</a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <h1 class="page-title">–ú–æ–π –ü—Ä–æ—Ñ–∏–ª—å</h1>

            <!-- Personal Data Section -->
            <section class="section" id="personal-data">
                <h2 class="section-title">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>

                <!-- Display Mode -->
                <div class="display-mode" id="personal-display">
                    <div class="display-grid">
                        <div class="display-field">
                            <div class="display-field-label">First Name (English) *</div>
                            <div class="display-field-value" id="display-first-name-en">Ivan</div>
                        </div>
                        <div class="display-field">
                            <div class="display-field-label">Last Name (English) *</div>
                            <div class="display-field-value" id="display-last-name-en">Ivanov</div>
                        </div>
                        <div class="display-field">
                            <div class="display-field-label">–ò–º—è</div>
                            <div class="display-field-value" id="display-first-name-ru">–ò–≤–∞–Ω</div>
                        </div>
                        <div class="display-field">
                            <div class="display-field-label">–§–∞–º–∏–ª–∏—è</div>
                            <div class="display-field-value" id="display-last-name-ru">–ò–≤–∞–Ω–æ–≤</div>
                        </div>
                        <div class="display-field">
                            <div class="display-field-label">–û—Ç—á–µ—Å—Ç–≤–æ</div>
                            <div class="display-field-value" id="display-patronymic">–ò–≤–∞–Ω–æ–≤–∏—á</div>
                        </div>
                        <div class="display-field">
                            <div class="display-field-label">–ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ *</div>
                            <div class="display-field-value" id="display-citizenship">–†–æ—Å—Å–∏–π—Å–∫–∞—è –§–µ–¥–µ—Ä–∞—Ü–∏—è</div>
                        </div>
                        <div class="display-field">
                            <div class="display-field-label">E-mail *</div>
                            <div class="display-field-value" id="display-email">space@gmail.com</div>
                        </div>
                        <div class="display-field">
                            <div class="display-field-label">Organization (English) *</div>
                            <div class="display-field-value" id="display-org-en">Moscow State University</div>
                        </div>
                        <div class="display-field" style="grid-column: 1 / -1;">
                            <div class="display-field-label">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</div>
                            <div class="display-field-value" id="display-org-ru">–ú–æ—Å–∫–æ–≤—Å–∫–∏–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–º–µ–Ω–∏ –ú.–í. –õ–æ–º–æ–Ω–æ—Å–æ–≤–∞</div>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="toggleEditMode('personal')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                </div>

                <!-- Edit Mode -->
                <div class="edit-mode hidden" id="personal-edit">
                    <form id="personal-form" onsubmit="savePersonalData(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required">First Name (English)</label>
                                <input type="text" class="form-input" id="first-name-en" value="Ivan" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label required">Last Name (English)</label>
                                <input type="text" class="form-input" id="last-name-en" value="Ivanov" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label optional">–ò–º—è</label>
                                <input type="text" class="form-input" id="first-name-ru" placeholder="–í–∞—à–µ –∏–º—è" value="–ò–≤–∞–Ω">
                            </div>
                            <div class="form-group">
                                <label class="form-label optional">–§–∞–º–∏–ª–∏—è</label>
                                <input type="text" class="form-input" id="last-name-ru" placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è" value="–ò–≤–∞–Ω–æ–≤">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label optional">–û—Ç—á–µ—Å—Ç–≤–æ</label>
                                <input type="text" class="form-input" id="patronymic" placeholder="–í–∞—à–µ –æ—Ç—á–µ—Å—Ç–≤–æ" value="–ò–≤–∞–Ω–æ–≤–∏—á">
                            </div>
                            <div class="form-group">
                                <label class="form-label required">–ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ</label>
                                <input type="text" class="form-input" id="citizenship" value="–†–æ—Å—Å–∏–π—Å–∫–∞—è –§–µ–¥–µ—Ä–∞—Ü–∏—è" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required">E-mail</label>
                                <input type="email" class="form-input" id="email" value="space@gmail.com" required>
                            </div>
                        </div>

                        <div class="form-row single">
                            <div class="form-group">
                                <label class="form-label required">Organization (English)</label>
                                <input type="text" class="form-input" id="org-en" value="Moscow State University" required>
                            </div>
                        </div>

                        <div class="form-row single">
                            <div class="form-group">
                                <label class="form-label optional">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</label>
                                <input type="text" class="form-input" id="org-ru" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º" value="–ú–æ—Å–∫–æ–≤—Å–∫–∏–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–º–µ–Ω–∏ –ú.–í. –õ–æ–º–æ–Ω–æ—Å–æ–≤–∞">
                            </div>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="consent-personal" required>
                            <label for="consent-personal">–î–∞—é —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ <a href="#">–æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</a></label>
                        </div>

                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button type="button" class="btn btn-secondary" onclick="cancelEdit('personal')">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- My Reports Section -->
            <!-- KMU 2026 Section -->
            <section class="section parent-section" id="kmu-2026">
                <h2 class="section-title">–ö–ú–£ 2026</h2>

                <div class="subsections-container">
                    <!-- Registration Subsection -->
                    <div class="section subsection" id="registration">
                        <h3 class="subsection-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é</h3>

                <!-- Info message when personal data is incomplete -->
                <div class="info-message" id="registration-locked-message" style="display: none;">
                    <strong>–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.</strong><br>
                    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ —Ä–∞–∑–¥–µ–ª–µ "–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ" (First Name, Last Name, Organization, E-mail, Citizenship).
                </div>

                <!-- Form Mode -->
                <div class="edit-mode" id="registration-form-mode">
                    <div class="notice-box info">
                        <strong>–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π —è–∑—ã–∫ —É—á–∞—Å—Ç–∏—è:</strong> –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
                    </div>

                    <p class="section-subtitle">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —É—á–∞—Å—Ç–∏—è –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é.</p>

                    <form id="registration-form" onsubmit="submitRegistration(event)">
                        <div class="form-group">
                            <label class="form-label required">–†–µ–∂–∏–º —É—á–∞—Å—Ç–∏—è</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="mode-speaker" name="participant-mode" value="speaker" checked>
                                    <label for="mode-speaker">–î–æ–∫–ª–∞–¥—á–∏–∫</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="mode-listener" name="participant-mode" value="listener">
                                    <label for="mode-listener">–°–ª—É—à–∞—Ç–µ–ª—å</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">–§–æ—Ä–º–∞ —É—á–∞—Å—Ç–∏—è</label>
                            <p style="font-size: 13px; color: #999; margin-bottom: 8px;">(–û—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —É—á–∞—Å—Ç–∏—è –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª–µ–Ω)</p>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="format-in-person" name="format" value="in-person" checked>
                                    <label for="format-in-person">–û—á–Ω—ã–π</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="format-online" name="format" value="online">
                                    <label for="format-online">–û–Ω–ª–∞–π–Ω</label>
                                </div>
                            </div>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="consent-registration" required>
                            <label for="consent-registration">–î–∞—é —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ <a href="#">–æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</a></label>
                        </div>

                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                        </div>
                    </form>
                </div>

                <!-- Success State -->
                <div class="success-state" id="registration-success">
                    <h3 class="success-message">–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é!</h3>

                    <div class="success-details">
                        <div class="detail-row">
                            <div class="detail-label">–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</div>
                            <div class="detail-value">22-24 –∞–ø—Ä–µ–ª—è, 2026–≥.</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</div>
                            <div class="detail-value">–ò–ö–ò –†–ê–ù, –ú–æ—Å–∫–≤–∞, –†–æ—Å—Å–∏—è</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">–†–µ–∂–∏–º —É—á–∞—Å—Ç–∏—è:</div>
                            <div class="detail-value" id="success-mode">–î–æ–∫–ª–∞–¥—á–∏–∫</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">–§–æ—Ä–º–∞ —É—á–∞—Å—Ç–∏—è:</div>
                            <div class="detail-value" id="success-format">–û—á–Ω–∞—è</div>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="editRegistration()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-secondary" onclick="cancelRegistration()">–û—Ç–º–µ–Ω–∏—Ç—å —É—á–∞—Å—Ç–∏–µ</button>
                    </div>
                </div>
                    </div>

                    <!-- Submit Report Subsection -->
                    <div class="section subsection" id="submit-report">
                        <h3 class="subsection-title">–ü–æ–¥–∞—Ç—å –¥–æ–∫–ª–∞–¥</h3>

                <!-- Info message when not registered -->
                <div class="info-message" id="submit-report-locked-message" style="display: none;">
                    <strong>–î–ª—è –ø–æ–¥–∞—á–∏ –¥–æ–∫–ª–∞–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é.</strong><br>
                    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ —Ä–∞–∑–¥–µ–ª–µ "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é" –≤—ã—à–µ.
                </div>

                <!-- Subtle info about listener option (shown only when registered) -->
                <p class="section-subtitle" id="listener-info-text" style="font-size: 13px; color: #999; margin-bottom: 20px; display: none;">
                    –ü–æ–¥–∞—á–∞ –¥–æ–∫–ª–∞–¥–∞ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞. –í—ã –º–æ–∂–µ—Ç–µ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –∫–∞–∫ —Å–ª—É—à–∞—Ç–µ–ª—å.
                </p>

                <!-- Form Mode -->
                <div class="edit-mode" id="report-form-mode">
                    <div class="notice-box info">
                        <strong>–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π —è–∑—ã–∫ –¥–æ–∫–ª–∞–¥–∞:</strong> –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
                    </div>

                    <p class="section-subtitle">–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –¥–æ–∫–ª–∞–¥, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∏–∂–µ. –í—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è.</p>

                    <form id="report-form" novalidate>
                        <div class="form-row single">
                            <div class="form-group">
                                <label class="form-label required">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫–ª–∞–¥–∞</label>
                                <input type="text" class="form-input" id="report-title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫–ª–∞–¥–∞">
                            </div>
                        </div>

                        <div class="form-row single">
                            <div class="form-group">
                                <label class="form-label required">–°–µ–∫—Ü–∏—è</label>
                                <select class="form-select" id="report-section">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–∫—Ü–∏—é</option>
                                    <option value="solar">–§–∏–∑–∏–∫–∞ —Å–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã</option>
                                    <option value="astrophysics">–ê—Å—Ç—Ä–æ—Ñ–∏–∑–∏–∫–∞ –∏ —Ä–∞–¥–∏–æ–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—è</option>
                                    <option value="remote">–î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ–µ –∑–æ–Ω–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ó–µ–º–ª–∏</option>
                                    <option value="instruments">–ö–æ—Å–º–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–±–æ—Ä–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç</option>
                                    <option value="theory">–¢–µ–æ—Ä–∏—è –∏ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤</option>
                                    <option value="planets">–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–µ—Ç</option>
                                    <option value="social">–ö–æ—Å–º–æ—Å –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –Ω–∞—É–∫–∞—Ö</option>
                                    <option value="junior">–î–æ–∫–ª–∞–¥—ã —é–Ω–∏–æ—Ä–æ–≤ (9‚Äì11 –∫–ª–∞—Å—Å)</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">–§–æ—Ä–º–∞ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="presentation-in-person" name="presentation-format" value="in-person" checked>
                                    <label for="presentation-in-person">–û—á–Ω–∞—è</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="presentation-online" name="presentation-format" value="online">
                                    <label for="presentation-online">–û–Ω–ª–∞–π–Ω</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-row single">
                            <div class="form-group">
                                <label class="form-label required">–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –¥–æ–∫–ª–∞–¥–∞</label>
                                <textarea class="form-input" id="report-abstract" rows="6" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–æ–∫–ª–∞–¥–∞ (–Ω–µ –±–æ–ª–µ–µ 2000 —Å–∏–º–≤–æ–ª–æ–≤)" maxlength="2000"></textarea>
                            </div>
                        </div>

                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">–ü–æ–¥–∞—Ç—å –¥–æ–∫–ª–∞–¥</button>
                        </div>
                    </form>
                </div>

                <!-- Success State -->
                <div class="success-state" id="report-success">
                    <h3 class="success-message">–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é!</h3>

                    <div class="success-details">
                        <div class="detail-row">
                            <div class="detail-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è:</div>
                            <div class="detail-value">22 –∞–ø—Ä–µ–ª—è, 2026–≥., 15:00</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">–ó–∞–ª:</div>
                            <div class="detail-value">–ö–∞–±–∏–Ω–µ—Ç ‚Ññ202</div>
                        </div>
                        <div class="detail-row" style="grid-template-columns: 1fr;">
                            <div class="detail-label">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫–ª–∞–¥–∞:</div>
                            <div class="report-title" id="success-report-title"></div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">–§–æ—Ä–º–∞ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è:</div>
                            <div class="detail-value" id="success-presentation-format">–û—á–Ω–∞—è</div>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="submitAnotherReport()">–ü–æ–¥–∞—Ç—å –µ—â–µ –æ–¥–∏–Ω –¥–æ–∫–ª–∞–¥</button>
                        <button class="btn btn-secondary" onclick="cancelReport()">–û—Ç–º–µ–Ω–∏—Ç—å —É—á–∞—Å—Ç–∏–µ</button>
                    </div>

                    <!-- Link to view all reports -->
                    <div id="view-reports-link" style="display: none; margin-top: 20px; padding: 14px 18px; background-color: #f9f8fc; border-radius: 10px; border-left: 3px solid #5B4E99;">
                        <a onclick="scrollToSection('my-reports')" style="color: #5B4E99; cursor: pointer; text-decoration: none; font-weight: 500; display: inline-flex; align-items: center; gap: 8px; font-size: 14px;">
                            <span>üìã</span>
                            <span>–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –º–æ–∏ –¥–æ–∫–ª–∞–¥—ã</span>
                            <span style="color: #999; font-size: 12px;">‚Üì</span>
                        </a>
                    </div>
                </div>
                    </div>

                    <!-- –ú–æ–∏ –¥–æ–∫–ª–∞–¥—ã Subsection -->
                    <div class="section subsection" id="my-reports">
                        <h3 class="subsection-title">–ú–æ–∏ –¥–æ–∫–ª–∞–¥—ã</h3>

                        <div class="info-text" style="margin-bottom: 20px; color: #666; font-size: 14px;">
                            –ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ –≤–∞—à–∏ –¥–æ–∫–ª–∞–¥—ã, –ø–æ–¥–∞–Ω–Ω—ã–µ –Ω–∞ –ö–ú–£ 2026. –í—ã –º–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª—è—Ç—å –∏—Ö –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–µ–º–∞ –∑–∞—è–≤–æ–∫.
                        </div>

                        <div id="my-reports-content">
                            <!-- This will be populated by JavaScript -->
                </div>
                    </div>
                </div>
            </section>

            <!-- Archive Section -->
            <section class="section" id="archive">
                <h2 class="section-title">–ê—Ä—Ö–∏–≤ —É—á–∞—Å—Ç–∏–π</h2>

                <div id="archive-content">
                    <!-- This will be populated by JavaScript -->
                </div>
            </section>

            <!-- Contacts Section -->
            <section class="section" id="contacts">
                <h2 class="section-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h2>

                <div class="contacts-compact">
                    <div class="contact-item">
                        <span class="contact-label">Email:</span>
                            <a href="mailto:kmu@cosmos.ru" class="contact-link">kmu@cosmos.ru</a>
                        </div>
                    <div class="contact-item">
                        <span class="contact-label">–ê–¥—Ä–µ—Å:</span>
                        <span>–ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–æ—Ñ—Å–æ—é–∑–Ω–∞—è, –¥. 84/32, –ò–ö–ò –†–ê–ù</span>
                    </div>
                    <div class="contact-item">
                        <span class="contact-label">–°–∞–π—Ç –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏:</span>
                            <a href="https://kmu.cosmos.ru" target="_blank" class="contact-link">kmu.cosmos.ru</a>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // ============================================
        // Utility Functions for Safety and Reliability
        // ============================================
        
        /**
         * Safely get element by ID with null check
         */
        function getElement(id) {
            const element = document.getElementById(id);
            if (!element) {
                console.warn(`Element with id "${id}" not found`);
            }
            return element;
        }
        
        /**
         * Safely get element by ID or throw error
         */
        function requireElement(id) {
            const element = document.getElementById(id);
            if (!element) {
                throw new Error(`Required element with id "${id}" not found`);
            }
            return element;
        }
        
        /**
         * Sanitize string to prevent XSS attacks
         */
        function escapeHtml(text) {
            if (text == null) return '';
            const div = document.createElement('div');
            div.textContent = String(text);
            return div.innerHTML;
        }
        
        /**
         * Safely set text content
         */
        function setTextContent(element, text) {
            if (element) {
                element.textContent = text != null ? String(text) : '';
            }
        }
        
        /**
         * Safely set innerHTML with sanitization
         */
        function setInnerHTML(element, html) {
            if (element) {
                element.innerHTML = html;
            }
        }
        
        /**
         * Safely get form value
         */
        function getFormValue(id, defaultValue = '') {
            const element = getElement(id);
            return element ? (element.value || defaultValue) : defaultValue;
        }
        
        /**
         * Safely set form value
         */
        function setFormValue(id, value) {
            const element = getElement(id);
            if (element) {
                element.value = value != null ? String(value) : '';
            }
        }
        
        /**
         * Safely check/uncheck radio button
         */
        function setRadioChecked(name, value) {
            const radio = document.querySelector(`input[name="${name}"][value="${value}"]`);
            if (radio) {
                radio.checked = true;
            }
        }
        
        /**
         * Safely get checked radio value
         */
        function getCheckedRadio(name, defaultValue = null) {
            const radio = document.querySelector(`input[name="${name}"]:checked`);
            return radio ? radio.value : defaultValue;
        }
        
        /**
         * Validate required field
         */
        function validateRequired(value, fieldName) {
            if (!value || !String(value).trim()) {
                throw new Error(`–ü–æ–ª–µ "${fieldName}" –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è`);
            }
            return true;
        }
        
        /**
         * Safe event listener attachment (prevents duplicates)
         */
        const eventListeners = new Map();
        function safeAddEventListener(element, event, handler, options) {
            if (!element) return;
            
            const key = `${element.id || 'unknown'}-${event}`;
            if (eventListeners.has(key)) {
                element.removeEventListener(event, eventListeners.get(key), options);
            }
            eventListeners.set(key, handler);
            element.addEventListener(event, handler, options);
        }
        
        /**
         * Error handler wrapper
         */
        function safeExecute(fn, errorMessage = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞') {
            try {
                return fn();
            } catch (error) {
                console.error(errorMessage, error);
                alert(`${errorMessage}: ${error.message || error}`);
                return null;
            }
        }
        
        // ============================================
        // State management
        // ============================================
        let state = {
            hasArchive: true, // Change to false to show empty state
            registrationSubmitted: false,
            participantMode: 'speaker', // 'speaker' or 'listener'
            reportSubmitted: false,
            submittedReports: [], // Array of submitted reports for KMU 2026
            archiveData: [
                {
                    year: '–ö–ú–£ 2025',
                    title: '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –≤ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –º–∞–ª—ã—Ö —É–¥–∞—Ä–Ω—ã—Ö –∫—Ä–∞—Ç–µ—Ä–æ–≤ –º–æ—Ä—è –í–æ—Å—Ç–æ—á–Ω–æ–≥–æ –Ω–∞ –∫–∞—Ä—Ç–µ LQM',
                    date: '15 –∞–ø—Ä–µ–ª—è, 2025–≥.',
                    location: '–ò–ö–ò –†–ê–ù, –ú–æ—Å–∫–≤–∞'
                },
                {
                    year: '–ö–ú–£ 2024',
                    title: '–ê–Ω–∞–ª–∏–∑ —Ç–æ–ø–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ª—É–Ω–Ω–æ–π –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –º–µ—Ç–æ–¥–æ–º –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è',
                    date: '20 –∞–ø—Ä–µ–ª—è, 2024–≥.',
                    location: '–ò–ö–ò –†–ê–ù, –ú–æ—Å–∫–≤–∞'
                }
            ]
        };

        // Navigation functions
        function scrollToSection(sectionId) {
            const section = getElement(sectionId);
            if (section) {
                // Get the section's position
                const sectionTop = section.getBoundingClientRect().top + window.pageYOffset;
                // Offset for the top navigation (60px height + 20px padding)
                const offset = 80;
                // Scroll to position minus offset
                window.scrollTo({
                    top: sectionTop - offset,
                    behavior: 'smooth'
                });
            }
        }

        function toggleSubmenu(submenuId) {
            const submenu = getElement(submenuId);
            if (submenu) {
            submenu.classList.toggle('active');
            }
        }

        // Personal Data functions
        function toggleEditMode(section) {
            if (section === 'personal') {
                const display = getElement('personal-display');
                const edit = getElement('personal-edit');
                const consent = getElement('consent-personal');
                if (display) display.classList.remove('active');
                if (edit) edit.classList.remove('hidden');
                if (consent) consent.checked = true;
            }
        }

        function cancelEdit(section) {
            if (section === 'personal') {
                const display = getElement('personal-display');
                const edit = getElement('personal-edit');
                if (display) display.classList.add('active');
                if (edit) edit.classList.add('hidden');
            }
        }

        // Check if personal data is complete
        function checkPersonalDataComplete() {
            const firstNameEn = getElement('display-first-name-en')?.textContent?.trim();
            const lastNameEn = getElement('display-last-name-en')?.textContent?.trim();
            const orgEn = getElement('display-org-en')?.textContent?.trim();
            const email = getElement('display-email')?.textContent?.trim();
            const citizenship = getElement('display-citizenship')?.textContent?.trim();

            return !!(firstNameEn && 
                     lastNameEn && 
                     orgEn && 
                     email && 
                     citizenship &&
                     firstNameEn !== '-' &&
                     lastNameEn !== '-' &&
                     orgEn !== '-' &&
                     email !== '-' &&
                     citizenship !== '-');
        }

        // Update registration section visibility
        function updateRegistrationVisibility() {
            const registrationSection = getElement('registration');
            const registrationForm = getElement('registration-form-mode');
            const registrationSuccess = getElement('registration-success');
            const lockedMessage = getElement('registration-locked-message');
            
            if (!registrationSection || !registrationForm || !registrationSuccess || !lockedMessage) {
                console.warn('Some elements for registration visibility are missing');
                return;
            }
            
            const isComplete = checkPersonalDataComplete();

            if (isComplete) {
                // Show registration form if not already registered
                if (!state.registrationSubmitted) {
                    registrationSection.classList.remove('locked');
                    registrationForm.style.display = 'block';
                    registrationSuccess.classList.remove('active');
                    lockedMessage.style.display = 'none';
                } else {
                    registrationSection.classList.remove('locked');
                    registrationForm.style.display = 'none';
                    registrationSuccess.classList.add('active');
                    lockedMessage.style.display = 'none';
                }
            } else {
                // Hide registration if personal data is incomplete
                registrationSection.classList.add('locked');
                registrationForm.style.display = 'none';
                registrationSuccess.classList.remove('active');
                lockedMessage.style.display = 'block';
            }

            // Update submit report section visibility
            updateSubmitReportVisibility();
        }

        // Update submit report section visibility
        function updateSubmitReportVisibility() {
            const submitReportSection = getElement('submit-report');
            const reportFormMode = getElement('report-form-mode');
            const reportSuccess = getElement('report-success');
            const lockedMessage = getElement('submit-report-locked-message');
            const listenerInfoText = getElement('listener-info-text');
            
            if (!submitReportSection || !reportFormMode || !reportSuccess || !lockedMessage || !listenerInfoText) {
                console.warn('Some elements for submit report visibility are missing');
                return;
            }

            if (state.registrationSubmitted && state.participantMode === 'speaker') {
                // Show submit report section if registered as speaker
                submitReportSection.classList.remove('locked');
                lockedMessage.style.display = 'none';
                
                // Show form or success state based on current state
                // Check if there's a success state visible or if we just submitted
                const isSuccessVisible = reportSuccess.classList.contains('active');
                if (isSuccessVisible || (state.reportSubmitted && state.submittedReports.length > 0)) {
                    // Show success state, hide form
                    reportFormMode.style.setProperty('display', 'none', 'important');
                    reportSuccess.classList.add('active');
                } else {
                    // Show form, hide success
                    reportFormMode.style.setProperty('display', 'block', 'important');
                    reportSuccess.classList.remove('active');
                }
                
                // Show subtle listener info text
                listenerInfoText.style.display = 'block';
            } else if (state.registrationSubmitted && state.participantMode === 'listener') {
                // Hide submit report section if registered as listener
                submitReportSection.classList.add('locked');
                reportFormMode.style.setProperty('display', 'none', 'important');
                reportSuccess.classList.remove('active');
                setInnerHTML(lockedMessage, '<strong>–í—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ —Å–ª—É—à–∞—Ç–µ–ª—å.</strong><br>–ü–æ–¥–∞—á–∞ –¥–æ–∫–ª–∞–¥–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ —Ä–µ–∂–∏–º–µ —Å–ª—É—à–∞—Ç–µ–ª—è.');
                lockedMessage.style.display = 'block';
                listenerInfoText.style.display = 'none';
            } else {
                // Hide submit report section if not registered
                submitReportSection.classList.add('locked');
                reportFormMode.style.setProperty('display', 'none', 'important');
                reportSuccess.classList.remove('active');
                setInnerHTML(lockedMessage, '<strong>–î–ª—è –ø–æ–¥–∞—á–∏ –¥–æ–∫–ª–∞–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é.</strong><br>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ —Ä–∞–∑–¥–µ–ª–µ "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é" –≤—ã—à–µ.');
                lockedMessage.style.display = 'block';
                listenerInfoText.style.display = 'none';
            }
        }

        function savePersonalData(event) {
            event.preventDefault();

            return safeExecute(() => {
                // Get form values with validation
            const data = {
                    firstNameEn: getFormValue('first-name-en', '').trim(),
                    lastNameEn: getFormValue('last-name-en', '').trim(),
                    firstNameRu: getFormValue('first-name-ru', '').trim(),
                    lastNameRu: getFormValue('last-name-ru', '').trim(),
                    patronymic: getFormValue('patronymic', '').trim(),
                    citizenship: getFormValue('citizenship', '').trim(),
                    email: getFormValue('email', '').trim(),
                    orgEn: getFormValue('org-en', '').trim(),
                    orgRu: getFormValue('org-ru', '').trim()
                };

                // Validate required fields
                try {
                    validateRequired(data.firstNameEn, '–ò–º—è (–∞–Ω–≥–ª.)');
                    validateRequired(data.lastNameEn, '–§–∞–º–∏–ª–∏—è (–∞–Ω–≥–ª.)');
                    validateRequired(data.orgEn, '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è (–∞–Ω–≥–ª.)');
                    validateRequired(data.email, 'E-mail');
                    validateRequired(data.citizenship, '–ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ');
                } catch (error) {
                    alert(error.message);
                    return false;
                }

            // Update display values
                setTextContent(getElement('display-first-name-en'), data.firstNameEn);
                setTextContent(getElement('display-last-name-en'), data.lastNameEn);
                setTextContent(getElement('display-first-name-ru'), data.firstNameRu || '-');
                setTextContent(getElement('display-last-name-ru'), data.lastNameRu || '-');
                setTextContent(getElement('display-patronymic'), data.patronymic || '-');
                setTextContent(getElement('display-citizenship'), data.citizenship);
                setTextContent(getElement('display-email'), data.email);
                setTextContent(getElement('display-org-en'), data.orgEn);
                setTextContent(getElement('display-org-ru'), data.orgRu || '-');

            // Update user name in sidebar
            const userName = data.firstNameRu && data.lastNameRu
                ? `${data.firstNameRu} ${data.lastNameRu}`
                : `${data.firstNameEn} ${data.lastNameEn}`;
                const userNameElement = document.querySelector('.user-name');
                if (userNameElement) {
                    userNameElement.textContent = userName;
                }

            const initials = data.firstNameRu && data.lastNameRu
                    ? `${data.firstNameRu[0] || ''}${data.lastNameRu[0] || ''}`
                    : `${data.firstNameEn[0] || ''}${data.lastNameEn[0] || ''}`;
                const avatarElement = document.querySelector('.user-avatar');
                if (avatarElement) {
                    avatarElement.textContent = initials;
                }

            // Switch to display mode
                const display = getElement('personal-display');
                const edit = getElement('personal-edit');
                if (display) display.classList.add('active');
                if (edit) edit.classList.add('hidden');

                // Update registration visibility
                updateRegistrationVisibility();
                return true;
            }, '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö');
        }

        // Registration functions
        function submitRegistration(event) {
            event.preventDefault();

            return safeExecute(() => {
                const formatRadio = document.querySelector('input[name="format"]:checked');
                const modeRadio = document.querySelector('input[name="participant-mode"]:checked');
                
                if (!formatRadio || !modeRadio) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —É—á–∞—Å—Ç–∏—è –∏ —Ä–µ–∂–∏–º —É—á–∞—Å—Ç–∏—è');
                    return false;
                }
                
                const format = formatRadio.value;
                const formatText = format === 'in-person' ? '–û—á–Ω—ã–π' : '–û–Ω–ª–∞–π–Ω';
                const participantMode = modeRadio.value;
                const modeText = participantMode === 'speaker' ? '–î–æ–∫–ª–∞–¥—á–∏–∫' : '–°–ª—É—à–∞—Ç–µ–ª—å';

                // Store previous mode to check if it changed
                const previousMode = state.participantMode;
                const wasRegistered = state.registrationSubmitted;

                setTextContent(getElement('success-format'), formatText);
                setTextContent(getElement('success-mode'), modeText);

                const registrationForm = getElement('registration-form-mode');
                const registrationSuccess = getElement('registration-success');
                
                if (!registrationForm || !registrationSuccess) {
                    console.error('Registration form elements not found');
                    return false;
                }

                registrationForm.style.display = 'none';
                registrationSuccess.classList.add('active');

            state.registrationSubmitted = true;
            state.participantMode = participantMode;

            // If mode changed from speaker to listener, hide report form
            // If mode changed from listener to speaker, show report form
            if (wasRegistered && previousMode !== participantMode) {
                if (previousMode === 'speaker' && participantMode === 'listener') {
                    // Hide report form and clear any submitted reports if switching to listener
                    // (optional: you might want to keep reports, but hide the form)
                } else if (previousMode === 'listener' && participantMode === 'speaker') {
                    // Show report form when switching to speaker
                }
            }

                // Update submit report section visibility
                updateSubmitReportVisibility();
                
                // Update registration visibility to ensure consistency
                updateRegistrationVisibility();
                return true;
            }, '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
        }

        function editRegistration() {
            const registrationForm = getElement('registration-form-mode');
            const registrationSuccess = getElement('registration-success');
            
            if (!registrationForm || !registrationSuccess) {
                console.error('Registration form elements not found');
                return;
            }

            // Show form, keep registration active
            registrationForm.style.display = 'block';
            registrationSuccess.classList.remove('active');

            // Fill form with current values
            setRadioChecked('participant-mode', state.participantMode);

            // Get current format from success state or use default
            const successFormat = getElement('success-format');
            const currentFormat = successFormat ? successFormat.textContent.trim() : '–û—á–Ω—ã–π';
            setRadioChecked('format', currentFormat === '–û–Ω–ª–∞–π–Ω' ? 'online' : 'in-person');

            // Ensure consent checkbox is checked
            const consent = getElement('consent-registration');
            if (consent) consent.checked = true;
        }

        function cancelRegistration() {
            const registrationForm = getElement('registration-form-mode');
            const registrationSuccess = getElement('registration-success');
            
            if (!registrationForm || !registrationSuccess) {
                console.error('Registration form elements not found');
                return;
            }

            registrationForm.style.display = 'block';
            registrationSuccess.classList.remove('active');

            // Reset form
            const form = getElement('registration-form');
            if (form) form.reset();
            setRadioChecked('format', 'in-person');
            setRadioChecked('participant-mode', 'speaker');

            state.registrationSubmitted = false;
            state.participantMode = 'speaker';

            // Update submit report section visibility
            updateSubmitReportVisibility();
            
            // Update registration visibility to ensure consistency
            updateRegistrationVisibility();
        }

        // Form submit handler
        function handleReportFormSubmit(event) {
            console.log('Form submit handler called');
            event.preventDefault();
            event.stopPropagation();
            submitReport(event);
            return false;
        }

        // Report submission functions
        function submitReport(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }

            // Prevent double submission
            if (window.isSubmittingReport) {
                console.log('Report submission already in progress, ignoring duplicate call');
                return false;
            }
            window.isSubmittingReport = true;

            return safeExecute(() => {
            // If editing, remove old report first
            if (window.editingReportId) {
                    const editingId = Number(window.editingReportId);
                    // Use loose equality to handle type differences
                    state.submittedReports = state.submittedReports.filter(r => r.id != editingId);
                window.editingReportId = null;
            }

                const titleInput = getElement('report-title');
                const sectionSelect = getElement('report-section');
                const abstractTextarea = getElement('report-abstract');
                
                if (!titleInput || !sectionSelect || !abstractTextarea) {
                    alert('–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã');
                    window.isSubmittingReport = false;
                return false;
            }
            
                // Validate form
                const title = titleInput.value.trim();
                const section = sectionSelect.value;
                const abstract = abstractTextarea.value.trim();
                
                try {
                    validateRequired(title, '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫–ª–∞–¥–∞');
                    validateRequired(section, '–°–µ–∫—Ü–∏—è');
                    validateRequired(abstract, '–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –¥–æ–∫–ª–∞–¥–∞');
                } catch (error) {
                    alert(error.message);
                    if (error.message.includes('–ù–∞–∑–≤–∞–Ω–∏–µ')) titleInput.focus();
                    else if (error.message.includes('–°–µ–∫—Ü–∏—è')) sectionSelect.focus();
                    else if (error.message.includes('–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è')) abstractTextarea.focus();
                    window.isSubmittingReport = false;
                return false;
            }

                const sectionText = sectionSelect.options[sectionSelect.selectedIndex]?.text || section;
            const formatRadio = document.querySelector('input[name="presentation-format"]:checked');
            const format = formatRadio ? formatRadio.value : 'in-person';
            const formatText = format === 'in-person' ? '–û—á–Ω–∞—è' : '–û–Ω–ª–∞–π–Ω';

            // Generate mock schedule data
            const rooms = ['–ö–∞–±–∏–Ω–µ—Ç ‚Ññ202', '–ö–∞–±–∏–Ω–µ—Ç ‚Ññ301', '–ê—É–¥–∏—Ç–æ—Ä–∏—è ‚Ññ101', '–ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü-–∑–∞–ª'];
            const times = ['10:00', '11:30', '14:00', '15:30', '17:00'];
            const dates = ['22 –∞–ø—Ä–µ–ª—è, 2026–≥.', '23 –∞–ø—Ä–µ–ª—è, 2026–≥.', '24 –∞–ø—Ä–µ–ª—è, 2026–≥.'];
            
            const reportData = {
                id: Date.now(),
                title: title,
                section: section,
                sectionText: sectionText,
                format: format,
                formatText: formatText,
                abstract: abstract,
                date: dates[Math.floor(Math.random() * dates.length)],
                time: times[Math.floor(Math.random() * times.length)],
                room: rooms[Math.floor(Math.random() * rooms.length)],
                status: 'pending',
                submittedAt: new Date().toISOString()
            };

            // Add to submitted reports
            state.submittedReports.push(reportData);

            // Set state before updating UI
            state.reportSubmitted = true;

            // Hide form and show success
                const formMode = getElement('report-form-mode');
                const successState = getElement('report-success');
                
                if (!formMode || !successState) {
                    console.error('Report form elements not found');
                    window.isSubmittingReport = false;
                    return false;
                }
                
                formMode.style.setProperty('display', 'none', 'important');
            successState.classList.add('active');

                // Update success details with actual data (with sanitization)
            const successDetails = document.querySelector('#report-success .success-details');
            if (!successDetails) {
                console.error('Success details element not found');
                // Still continue to save the report even if display fails
            } else {
                    setInnerHTML(successDetails, `
                    <div class="detail-row">
                        <div class="detail-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è:</div>
                            <div class="detail-value">${escapeHtml(reportData.date)}, ${escapeHtml(reportData.time)}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">–ó–∞–ª:</div>
                            <div class="detail-value">${escapeHtml(reportData.room)}</div>
                    </div>
                    <div class="detail-row" style="grid-template-columns: 1fr;">
                        <div class="detail-label">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫–ª–∞–¥–∞:</div>
                            <div class="report-title" id="success-report-title">${escapeHtml(title)}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">–°–µ–∫—Ü–∏—è:</div>
                            <div class="detail-value">${escapeHtml(sectionText)}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">–§–æ—Ä–º–∞ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è:</div>
                            <div class="detail-value" id="success-presentation-format">${escapeHtml(formatText)}</div>
                    </div>
                    `);
            }

            // Refresh reports lists
            renderMyReports();
                updateViewReportsLink();

                // Update visibility to ensure form stays hidden
                updateSubmitReportVisibility();

                // Reset submission flag after a short delay
                setTimeout(() => {
                    window.isSubmittingReport = false;
                }, 500);
                
                return true;
            }, '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∞—á–µ –¥–æ–∫–ª–∞–¥–∞');
            
            // If safeExecute returned false, reset flag
            if (window.isSubmittingReport) {
                setTimeout(() => {
                    window.isSubmittingReport = false;
                }, 100);
            }
        }

        function cancelReport() {
            const formMode = getElement('report-form-mode');
            const successState = getElement('report-success');
            
            if (!formMode || !successState) {
                console.error('Report form elements not found');
                return;
            }
            
            formMode.style.setProperty('display', 'block', 'important');
            successState.classList.remove('active');

            // Reset form
            const form = getElement('report-form');
            if (form) form.reset();
            setRadioChecked('presentation-format', 'in-person');

            state.reportSubmitted = false;

            // Update visibility
            updateSubmitReportVisibility();
        }

        function submitAnotherReport() {
            // Reset form and show it
            const formMode = getElement('report-form-mode');
            const successState = getElement('report-success');
            const form = getElement('report-form');
            
            if (!formMode || !successState || !form) {
                console.error('Report form elements not found');
                return;
            }
            
            // Hide success state
            successState.classList.remove('active');
            
            // Show form
            formMode.style.setProperty('display', 'block', 'important');
            
            // Reset form
            form.reset();
            setRadioChecked('presentation-format', 'in-person');
            
            // Reset submission state
            state.reportSubmitted = false;
            
            // Ensure form submit handler is attached (using safe method)
            safeAddEventListener(form, 'submit', handleReportFormSubmit);
            
            // Update visibility
            updateSubmitReportVisibility();
            
            // Scroll to form and focus
            setTimeout(() => {
                const titleInput = getElement('report-title');
                if (titleInput) {
                    titleInput.focus();
                }
                scrollToSection('submit-report');
            }, 100);
        }

        // My Reports functions
        function renderMyReports() {
            const myReportsContent = getElement('my-reports-content');
            
            if (!myReportsContent) {
                console.error('My reports content element not found');
                return;
            }

            if (state.submittedReports.length === 0) {
                setInnerHTML(myReportsContent, `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <div class="empty-state-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–∞–Ω–Ω—ã—Ö –¥–æ–∫–ª–∞–¥–æ–≤ –Ω–∞ –ö–ú–£ 2026</div>
                    </div>
                `);
            } else {
                // Update view reports link when rendering
                updateViewReportsLink();
                
                // Sanitize all user input to prevent XSS
                const reportsHtml = state.submittedReports.map(report => {
                    const safeTitle = escapeHtml(report.title);
                    const safeSectionText = escapeHtml(report.sectionText);
                    const safeFormatText = escapeHtml(report.formatText);
                    const safeDate = report.date ? escapeHtml(report.date) : '';
                    const safeTime = report.time ? escapeHtml(report.time) : '';
                    const safeRoom = report.room ? escapeHtml(report.room) : '';
                    const safeStatus = escapeHtml(report.status);
                    const safeStatusText = escapeHtml(getStatusText(report.status));
                    const reportId = Number(report.id) || 0; // Ensure it's a number for onclick
                    
                    return `
                            <div class="report-card">
                                <div class="report-card-header">
                                    <div style="flex: 1;">
                                    <div class="report-card-title">${safeTitle}</div>
                                        <div class="report-card-meta">
                                        <div><strong>–°–µ–∫—Ü–∏—è:</strong> ${safeSectionText}</div>
                                        <div><strong>–§–æ—Ä–º–∞:</strong> ${safeFormatText}</div>
                                        ${safeDate ? `<div><strong>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</strong> ${safeDate}, ${safeTime}</div>` : ''}
                                        ${safeRoom ? `<div><strong>–ó–∞–ª:</strong> ${safeRoom}</div>` : ''}
                                        </div>
                                    </div>
                                <span class="report-status ${safeStatus}">${safeStatusText}</span>
                                </div>
                                <div class="report-card-actions">
                                <button class="btn btn-secondary btn-small" onclick="editReport(${reportId})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button class="btn btn-secondary btn-small" onclick="deleteReport(${reportId})">–£–¥–∞–ª–∏—Ç—å</button>
                                </div>
                    </div>
                `;
                }).join('');
                
                setInnerHTML(myReportsContent, `<div class="report-list">${reportsHtml}</div>`);
            }
        }

        // Update view reports link visibility
        function updateViewReportsLink() {
            const viewReportsLink = getElement('view-reports-link');
            if (viewReportsLink) {
                // Show link only if there are submitted reports AND user is registered as speaker
                const shouldShow = state.submittedReports.length > 0 && 
                                  state.registrationSubmitted && 
                                  state.participantMode === 'speaker';
                viewReportsLink.style.display = shouldShow ? 'block' : 'none';
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': '–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏',
                'accepted': '–ü—Ä–∏–Ω—è—Ç',
                'scheduled': '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω'
            };
            return statusMap[status] || String(status);
        }

        function editReport(reportId) {
            console.log('editReport called with:', reportId, 'type:', typeof reportId);
            
            // Convert to number for consistency
            const numericReportId = Number(reportId);
            
            // Use loose equality (==) to handle both string and number types
            const report = state.submittedReports.find(r => r.id == numericReportId);
            if (!report) {
                console.warn(`Report with id ${reportId} not found`);
                alert('–û—à–∏–±–∫–∞: –¥–æ–∫–ª–∞–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            // Store report ID for later deletion (as number)
            window.editingReportId = numericReportId;

            // Scroll to submit report section
            scrollToSection('submit-report');

            // Fill form with report data
            setFormValue('report-title', report.title);
            setFormValue('report-section', report.section);
            setFormValue('report-abstract', report.abstract);
            
            setRadioChecked('presentation-format', report.format);

            // Show form
            const formMode = getElement('report-form-mode');
            const successState = getElement('report-success');
            
            if (!formMode || !successState) {
                console.error('Report form elements not found');
                return;
            }
            
            successState.classList.remove('active');
            formMode.style.setProperty('display', 'block', 'important');
            
            // Reset submission state
            state.reportSubmitted = false;
        }

        function deleteReport(reportId) {
            console.log('deleteReport called with:', reportId, 'type:', typeof reportId);
            console.log('Current reports:', state.submittedReports.map(r => ({id: r.id, type: typeof r.id, title: r.title})));
            
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–æ–∫–ª–∞–¥?')) {
                return;
            }
            
            // Convert reportId to number to ensure type consistency
            const numericReportId = Number(reportId);
            console.log('Numeric ID:', numericReportId);
            
            const initialLength = state.submittedReports.length;
            
            // Use loose equality (==) to handle both string and number types
            state.submittedReports = state.submittedReports.filter(r => {
                const matches = r.id == numericReportId; // Use == instead of !==
                console.log(`Comparing report ${r.id} (${typeof r.id}) with ${numericReportId} (${typeof numericReportId}): ${matches ? 'match' : 'no match'}`);
                return !matches;
            });
            
            console.log('Reports after filter:', state.submittedReports.length);
            
            if (state.submittedReports.length < initialLength) {
                console.log('Report deleted successfully');
                renderMyReports();
                updateViewReportsLink();
                
                // If no reports left, update visibility
                if (state.submittedReports.length === 0) {
                    updateSubmitReportVisibility();
                }
            } else {
                console.error(`Failed to delete report with id ${reportId}`);
                alert('–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –¥–æ–∫–ª–∞–¥');
            }
        }

        // Archive functions
        function renderArchive() {
            const archiveContent = getElement('archive-content');
            
            if (!archiveContent) {
                console.error('Archive content element not found');
                return;
            }

            if (!state.hasArchive || state.archiveData.length === 0) {
                setInnerHTML(archiveContent, `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <div class="empty-state-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–æ–∫–ª–∞–¥–æ–≤ –≤ –∞—Ä—Ö–∏–≤–µ</div>
                    </div>
                `);
            } else {
                // Sanitize archive data to prevent XSS
                const archiveHtml = state.archiveData.map(item => {
                    const safeYear = escapeHtml(item.year || '');
                    const safeTitle = escapeHtml(item.title || '');
                    const safeDate = escapeHtml(item.date || '');
                    const safeLocation = escapeHtml(item.location || '');
                    
                    return `
                    <div class="archive-item">
                            <div class="archive-year">${safeYear}</div>
                            <div class="archive-title">${safeTitle}</div>
                            <div class="archive-meta">${safeDate} ‚Ä¢ ${safeLocation}</div>
                    </div>
                    `;
                }).join('');
                
                setInnerHTML(archiveContent, archiveHtml);
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            safeExecute(() => {
            // Set initial display mode for personal data
                const personalDisplay = getElement('personal-display');
                if (personalDisplay) {
                    personalDisplay.classList.add('active');
                }

            // Render archive
            renderArchive();

            // Render my reports
            renderMyReports();

                // Update view reports link
                updateViewReportsLink();

                // Update registration visibility based on personal data
                updateRegistrationVisibility();

                // Explicitly ensure report form is hidden on load
                const reportFormMode = getElement('report-form-mode');
                if (reportFormMode) {
                    if (!state.registrationSubmitted || state.participantMode !== 'speaker') {
                        reportFormMode.style.setProperty('display', 'none', 'important');
                    }
                }

            // Auto-open KMU submenu
                const kmuSubmenu = getElement('kmu-submenu');
                if (kmuSubmenu) {
                    kmuSubmenu.classList.add('active');
                }

                // Attach form submit handler (using safe method)
                const reportForm = getElement('report-form');
            if (reportForm) {
                    safeAddEventListener(reportForm, 'submit', handleReportFormSubmit);
                }
            }, '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
        });
    </script>
</body>
</html>
